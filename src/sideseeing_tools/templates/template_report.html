<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="template.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    </head>
<body>
    <div class="sidebar">
        <h4 class="px-3">Relatório de Dados</h4>
        <hr>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="#" onclick="showSection('summary')">Resumo</a>
            </li>
            {% if sections.geo %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('geo')">Dados Geoespaciais</a>
            </li>
            {% endif %}
            {% if sections.sensor %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('sensor')">Dados de Sensores</a>
            </li>
            {% endif %}
            {% if sections.wifi %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('wifi')">Dados de Wi-Fi</a>
            </li>
            {% endif %}
            {% if sections.images %}
            {% endif %}
        </ul>
        <div class="position-absolute bottom-0 w-100 p-3">
             <small class="text-muted">Gerado em: {{ data_geracao }}</small>
        </div>
    </div>

    <div class="content">
        <div id="summary" class="section active">
            <h2>Resumo do Dataset</h2>
            <p>Visão geral dos dados extraídos do diretório.</p>
            
            <div class="row">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total de Amostras</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{ summary.total_instances }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Duração Total (Segundos)</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{ "%.2f"|format(summary.total_duration_seconds) }} s</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Dispositivos e SO</h6>
                        </div>
                        <div class="card-body">
                            <strong>Fabricante/Modelo:</strong>
                            <ul>
                                {% for device in summary.devices_manufacturer %}
                                    <li>{{ device }}</li>
                                {% endfor %}
                            </ul>
                            <strong>Versões do Android:</strong>
                            <ul>
                                {% for version in summary.so_versions %}
                                    <li>{{ version }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6 mb-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Tipos de Sensores Disponíveis</h6>
                        </div>
                        <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                            <ul>
                                {% for sensor in summary.sensor_types|sort %}
                                    <li>{{ sensor }}</li>
                                {% else %}
                                    <li>Nenhum sensor encontrado.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        {% if sections.geo %}
        <div id="geo" class="section">
            <h2>Dados Geoespaciais</h2>
            <p>Adicione uma amostra para visualizar a rota GPS capturada.</p>
            
            <div class="row mb-3 align-items-end">
                <div class="col-md-6">
                    <label for="geo-select" class="form-label"><strong>1. Selecionar Amostra:</strong></label>
                    <select class="form-select" id="geo-select">
                        <option selected disabled value="">-- Escolha uma amostra para adicionar --</option>
                        {% for instance_name, json_path in sections.geo.items() %}
                            <option value="{{ json_path }}">{{ instance_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" id="add-geo-sample-btn">Adicionar Rota</button>
                    <button class="btn btn-danger" id="reset-geo-view-btn">Limpar Tudo</button>
                </div>
            </div>
        
            <div id="geo-map-container" class="mt-4 row">
                
                <div class="text-center text-muted" id="geo-map-placeholder">
                    <p class="fs-5">Adicione uma amostra para começar.</p>
                </div>

                <div class="loading-spinner d-none justify-content-center p-5" id="geo-map-spinner">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Carregando dados...</span>
                    </div>
                </div>

            </div>
        </div>
        {% endif %}

        {% if sections.sensor %}
        <div id="sensor" class="section">
            <h2>Dados de Sensores</h2>
            <p>Adicione uma ou mais amostras para comparar os dados dos sensores.</p>
            
            <div class="row mb-3 align-items-end">
                <div class="col-md-6">
                    <label for="sensor-select" class="form-label"><strong>1. Selecionar Amostra:</strong></label>
                    <select class="form-select" id="sensor-select">
                        <option selected disabled value="">-- Escolha uma amostra para adicionar --</option>
                        {% for instance_name, json_path in sections.sensor.items() %}
                            <option value="{{ json_path }}">{{ instance_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" id="add-sample-btn">Adicionar</button>
                    <button class="btn btn-danger" id="reset-view-btn">Limpar Tudo</button>
                </div>
            </div>
        
            <div class="mb-3" id="sensor-checkboxes-container" style="display: none;">
                <label class="form-label"><strong>2. Sensores Carregados:</strong></label>
                <div class="border rounded p-3" id="sensor-checkboxes-list" style="max-height: 300px; overflow-y: auto;">
                    </div>
                <div class="mt-2">
                    <button class="btn btn-sm btn-outline-secondary" id="check-all-sensors">Marcar Todos</button>
                    <button class="btn btn-sm btn-outline-secondary" id="uncheck-all-sensors">Desmarcar Todos</button>
                </div>
            </div>

            <div id="charts-container" class="mt-4 row">
                
                <div class="text-center text-muted" id="charts-placeholder">
                    <p class="fs-5">Adicione uma amostra para começar.</p>
                </div>

                <div class="loading-spinner d-none justify-content-center p-5" id="charts-spinner">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Carregando dados...</span>
                    </div>
                </div>

            </div>
        </div>
        {% endif %}
        
        {% if sections.wifi %}
        <div id="wifi" class="section">
            <h2>Mapas de Calor de Wi-Fi</h2>
            <p>Adicione uma amostra para visualizar os heatmaps dos SSIDs encontrados.</p>
            
            <div class="row mb-3 align-items-end">
                <div class="col-md-6">
                    <label for="wifi-select" class="form-label"><strong>1. Selecionar Amostra:</strong></label>
                    <select class="form-select" id="wifi-select">
                        <option selected disabled value="">-- Escolha uma amostra para adicionar --</option>
                        {% for instance_name, json_path in sections.wifi.items() %}
                            <option value="{{ json_path }}">{{ instance_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" id="add-wifi-sample-btn">Adicionar</button>
                    <button class="btn btn-danger" id="reset-wifi-view-btn">Limpar Tudo</button>
                </div>
            </div>
        
            <div class="mb-3" id="wifi-controls-container" style="display: none;">
                <label class="form-label"><strong>2. SSIDs Carregados:</strong></label>
                <div class="border rounded p-3" id="wifi-controls-list" style="max-height: 300px; overflow-y: auto;">
                    </div>
            </div>

            <div id="wifi-map-container" class="mt-4 row">
                
                <div class="text-center text-muted" id="wifi-map-placeholder">
                    <p class="fs-5">Adicione uma amostra para começar.</p>
                </div>

                <div class="loading-spinner d-none justify-content-center p-5" id="wifi-map-spinner">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Carregando dados...</span>
                    </div>
                </div>

            </div>
        </div>
        {% endif %}

        {% if sections.images %}
        <div id="images" class="section">
            <h2>Imagens</h2>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="template2.js"></script>
</body>
</html>